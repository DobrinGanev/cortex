!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cortex=e()}}(function(){var e;return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var o="function"==typeof require&&require;if(!u&&o)return o(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return i(n?n:t)},h,h.exports,t,e,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var i=n[r],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):r(e,t))}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var i=e,a=t,s=n;u=l=o=void 0,r=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,a);if(void 0!==u){if("value"in u)return u.value;var o=u.get;return void 0===o?void 0:o.call(s)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=a,n=s,r=!0}};t.exports=function(){var t=e("./pubsub"),n=e("./data_wrapper")(t),r={N:"new",E:"update",A:"update",D:"delete"},o=function(e){function n(e,t){i(this,n),u(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,e),this.__value=e,this.__path=[],this.__updates=[],this.__callbacks=t?[t]:[],this.__loopProcessing=!1,this.__subscribe(),this.__changes=[],this.__wrap()}return a(n,e),s(n,[{key:"on",value:function(e,t){"update"===e&&this.__callbacks.push(t)}},{key:"off",value:function(e,t){if("update"===e)if(t){for(var n=0,r=this.__callbacks.length;r>n;n++)if(t===this.__callbacks[n]){this.__callbacks.splice(n,1);break}}else this.__callbacks=[]}},{key:"update",value:function(e){return this.__checkUpdate(e.oldValue,e.value,e.path)?(this.__loopProcessing||(this.__loopProcessing=!0,setTimeout(this.__batchAll.bind(this),0)),!0):!1}},{key:"__batchAll",value:function(){this.__batchSetValue(),this.__wrap(),this.__loopProcessing=!1,this.__runCallbacks()}},{key:"__batchSetValue",value:function(){for(var e=0,t=this.__updates.length;t>e;e++)this.__setValue(this.__updates[e].newValue,this.__updates[e].path);this.__updates=[]}},{key:"__runCallbacks",value:function(){for(var e=0,t=this.__callbacks.length;t>e;e++)this.__callbacks[e]&&this.__callbacks[e](this)}},{key:"__subscribe",value:function(){this.__eventId=t.subscribeToCortex(function(e,t){this.update(t)}.bind(this),function(e,t){this.__remove(t.path)}.bind(this))}},{key:"__remove",value:function(e){if(e.length){var t=e.slice(0,e.length-1),n=this.__subValue(t),r=e[e.length-1],i=n[r],a=this.constructor.deepClone(n);return n.constructor===Object?delete n[r]:n.constructor===Array&&n.splice(r,1),this.update({value:n,path:t,oldValue:a}),i}delete this.__wrappers,delete this.__value}},{key:"__setValue",value:function(e,t){if(t.length>1){var n=this.__subValue(t.slice(0,t.length-1));n[t[t.length-1]]=e}else 1===t.length?this.__value[t[0]]=e:this.__value=e}},{key:"__checkUpdate",value:function(e,t,n){var r;if(e)return r=this.constructor.deepDiff(e,t),this.__computeChanges(r,n),!0;var e=this.__subValue(n);return r=this.constructor.deepDiff(e,t),r?(this.__updates.push({newValue:t,path:n}),this.__computeChanges(r,n),!0):!1}},{key:"__computeChanges",value:function(e,t){var n,i,a;this.__loopProcessing||(this.__changes=[]);for(var s=0,u=e.length;u>s;s++)a=e[s],n=r[a.item?a.item.kind:a.kind],i=t.slice(),a.path&&(i=i.concat(a.path)),a.index&&i.push(a.index),this.__changes.push({type:n,path:i,oldValue:a.item?a.item.lhs:a.lhs,newValue:a.item?a.item.rhs:a.rhs})}}]),n}(n);return"undefined"!=typeof window&&null!==window&&(window.Cortex=o),o}()},{"./data_wrapper":3,"./pubsub":4}],2:[function(t,n,r){(function(t){!function(t,i){"use strict";"function"==typeof e&&e.amd?e([],i):"object"==typeof r?n.exports=i():t.DeepDiff=i()}(this,function(e){"use strict";function n(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function i(e,t,n){i.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function a(e,t){a.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function s(e,t){s.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function u(e,t,n){u.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function o(e,t,n){var r=e.slice((n||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,r),e}function l(e){var t=typeof e;return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":e instanceof Date?"date":/^\/.*\//.test(e.toString())?"regexp":"object"}function h(t,n,r,c,f,p,_){f=f||[];var v=f.slice(0);if("undefined"!=typeof p){if(c&&c(v,p,{lhs:t,rhs:n}))return;v.push(p)}var d=typeof t,b=typeof n;if("undefined"===d)"undefined"!==b&&r(new a(v,n));else if("undefined"===b)r(new s(v,t));else if(l(t)!==l(n))r(new i(v,t,n));else if(t instanceof Date&&n instanceof Date&&t-n!==0)r(new i(v,t,n));else if("object"===d&&null!==t&&null!==n){if(_=_||[],_.indexOf(t)<0){if(_.push(t),Array.isArray(t)){{var y;t.length}for(y=0;y<t.length;y++)y>=n.length?r(new u(v,y,new s(e,t[y]))):h(t[y],n[y],r,c,v,y,_);for(;y<n.length;)r(new u(v,y,new a(e,n[y++])))}else{var g=Object.keys(t),w=Object.keys(n);g.forEach(function(i,a){var s=w.indexOf(i);s>=0?(h(t[i],n[i],r,c,v,i,_),w=o(w,s)):h(t[i],e,r,c,v,i,_)}),w.forEach(function(t){h(e,n[t],r,c,v,t,_)})}_.length=_.length-1}}else t!==n&&("number"===d&&isNaN(t)&&isNaN(n)||r(new i(v,t,n)))}function c(t,n,r,i){return i=i||[],h(t,n,function(e){e&&i.push(e)},r),i.length?i:e}function f(e,t,n){if(n.path&&n.path.length){var r,i=e[t],a=n.path.length-1;for(r=0;a>r;r++)i=i[n.path[r]];switch(n.kind){case"A":f(i[n.path[r]],n.index,n.item);break;case"D":delete i[n.path[r]];break;case"E":case"N":i[n.path[r]]=n.rhs}}else switch(n.kind){case"A":f(e[t],n.index,n.item);break;case"D":e=o(e,t);break;case"E":case"N":e[t]=n.rhs}return e}function p(e,t,n){if(e&&t&&n&&n.kind){for(var r=e,i=-1,a=n.path.length-1;++i<a;)"undefined"==typeof r[n.path[i]]&&(r[n.path[i]]="number"==typeof n.path[i]?[]:{}),r=r[n.path[i]];switch(n.kind){case"A":f(r[n.path[i]],n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}}function _(e,t,n){if(n.path&&n.path.length){var r,i=e[t],a=n.path.length-1;for(r=0;a>r;r++)i=i[n.path[r]];switch(n.kind){case"A":_(i[n.path[r]],n.index,n.item);break;case"D":i[n.path[r]]=n.lhs;break;case"E":i[n.path[r]]=n.lhs;break;case"N":delete i[n.path[r]]}}else switch(n.kind){case"A":_(e[t],n.index,n.item);break;case"D":e[t]=n.lhs;break;case"E":e[t]=n.lhs;break;case"N":e=o(e,t)}return e}function v(e,t,n){if(e&&t&&n&&n.kind){var r,i,a=e;for(i=n.path.length-1,r=0;i>r;r++)"undefined"==typeof a[n.path[r]]&&(a[n.path[r]]={}),a=a[n.path[r]];switch(n.kind){case"A":_(a[n.path[r]],n.index,n.item);break;case"D":a[n.path[r]]=n.lhs;break;case"E":a[n.path[r]]=n.lhs;break;case"N":delete a[n.path[r]]}}}function d(e,t,n){if(e&&t){var r=function(r){(!n||n(e,t,r))&&p(e,t,r)};h(e,t,r)}}var b,y,g=[];return b="object"==typeof t&&t?t:"undefined"!=typeof window?window:{},y=b.DeepDiff,y&&g.push(function(){"undefined"!=typeof y&&b.DeepDiff===c&&(b.DeepDiff=y,y=e)}),n(i,r),n(a,r),n(s,r),n(u,r),Object.defineProperties(c,{diff:{value:c,enumerable:!0},observableDiff:{value:h,enumerable:!0},applyDiff:{value:d,enumerable:!0},applyChange:{value:p,enumerable:!0},revertChange:{value:v,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof y},enumerable:!0},noConflict:{value:function(){return g&&(g.forEach(function(e){e()}),g=null),c},enumerable:!0}}),c})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=function(t){var n=e("deep-diff").diff,a=function(){function e(t){r(this,e),this.__eventId=t.eventId,this.__value=t.value,this.__path=t.path||[],this.__changes=t.changes||[],this.__wrap(),this.val=this.getValue}return i(e,[{key:"set",value:function(e,n){var r=n||{};r.value=e,r.path=this.__path,t.publish("update"+this.__eventId,r)}},{key:"getValue",value:function(){return this.__value}},{key:"getPath",value:function(){return this.__path}},{key:"getKey",value:function(){return this.__path[this.__path.length-1]}},{key:"getChanges",value:function(){return this.__changes}},{key:"didChange",value:function(e){if(!e)return this.__changes.length>0;for(var t=0,n=this.__changes.length;n>t;t++){var r=this.__changes[t];if(r.path[0]===e||this.__hasChange(r,e))return!0}return!1}},{key:"forEach",value:function(e){if(this.__isObject())for(var t in this.__wrappers)e(t,this.__wrappers[t],this.__wrappers);else this.__isArray()&&this.__wrappers.forEach(e)}},{key:"remove",value:function(){t.publish("remove"+this.__eventId,{path:this.__path})}},{key:"__subValue",value:function(e){for(var t=this.__value,n=0,r=e.length;r>n;n++)t=t[e[n]];return t}},{key:"__wrap",value:function(){if(this.__cleanup(),this.__isObject()){this.__wrappers={};for(var e in this.__value)this.__wrapChild(e)}else if(this.__isArray()){this.__wrappers=[];for(var t=0,n=this.__value.length;n>t;t++)this.__wrapChild(t)}}},{key:"__wrapChild",value:function(t){var n=this.__path.slice();n.push(t),this.__wrappers[t]=new e({value:this.__value[t],path:n,eventId:this.__eventId,changes:this.__childChanges(t)}),this[t]=this.__wrappers[t]}},{key:"__childChanges",value:function(e){for(var t,n=[],r=0,i=this.__changes.length;i>r;r++)t=this.__changes[r],t.path[0]===e?n.push({type:t.type,path:t.path.slice(1,t.path.length),oldValue:t.oldValue,newValue:t.newValue}):this.__hasChange(t,e)&&n.push({type:t.type,path:[],oldValue:t.oldValue?t.oldValue[e]:void 0,newValue:t.newValue?t.newValue[e]:void 0});return n}},{key:"__hasChange",value:function(e,t){return 0===e.path.length&&(e.oldValue&&e.oldValue[t]||e.newValue&&e.newValue[t])}},{key:"__cleanup",value:function(){if(this.__wrappers){if(this.__isObject())for(var e in this.__wrappers)delete this[e];else if(this.__isArray())for(var t=0,n=this.__wrappers.length;n>t;t++)delete this[t];delete this.__wrappers}}},{key:"__isObject",value:function(){return this.__value&&this.__value.constructor===Object}},{key:"__isArray",value:function(){return this.__value&&this.__value.constructor===Array}}],[{key:"deepDiff",value:function(e,t){return n(e,t)}},{key:"deepClone",value:function(t){var n;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return n=new Date,n.setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var r=0,i=t.length;i>r;r++)n[r]=e.deepClone(t[r]);return n}if(t instanceof Object){n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=e.deepClone(t[a]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}}]),e}(),s=e("./wrappers/array"),u=e("./wrappers/hash"),o=function(e,t){for(var n=0,r=t.length;r>n;n++)for(var i in t[n])e.prototype[i]=t[n][i]};return o(a,[s,u]),a}},{"./wrappers/array":5,"./wrappers/hash":6,"deep-diff":2}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=function(){var e=function(){function e(){r(this,e),this.uid=-1,this.topics={}}return i(e,[{key:"subscribe",value:function(e,t){this.topics.hasOwnProperty(e)||(this.topics[e]=[]),this.topics[e].push({callback:t})}},{key:"publish",value:function(e,t){if(!this.topics.hasOwnProperty(e))return!1;for(var n=this.topics[e],r=0,i=n.length;i>r;r++)n[r].callback(e,t);return!0}},{key:"subscribeToCortex",value:function(e,t){return this.uid+=1,this.subscribe("update"+this.uid,e),this.subscribe("remove"+this.uid,t),this.uid}},{key:"unsubscribeFromCortex",value:function(e){delete this.topics["update"+e],delete this.topics["remove"+e]}}]),e}();return new e}()},{}],5:[function(e,t,n){"use strict";var r={count:function(){return this.__value.length},map:function(e){return this.__wrappers.map(e)},filter:function(e,t){return this.__wrappers.filter(e,t)},find:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return this.__wrappers[t];return null},findIndex:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return t;return-1},push:function(e){var t=this.constructor.deepClone(this.__value),n=this.__value.push(e);return this.set(this.__value,{oldValue:t}),n},pop:function(){var e=this.constructor.deepClone(this.__value),t=this.__value.pop();return this.set(this.__value,{oldValue:e}),t},unshift:function(e){var t=this.constructor.deepClone(this.__value),n=this.__value.unshift(e);return this.set(this.__value,{oldValue:t}),n},shift:function(){var e=this.constructor.deepClone(this.__value),t=this.__value.shift();return this.set(this.__value,{oldValue:e}),t},insertAt:function(e){var t=this.constructor.deepClone(this.__value),n=Array.prototype.slice.call(arguments,1);Array.prototype.splice.apply(this.__value,[e,0].concat(n)),this.set(this.__value,{oldValue:t})},removeAt:function(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=this.constructor.deepClone(this.__value),r=this.__value.splice(e,t);return this.set(this.__value,{oldValue:n}),r}};t.exports=r},{}],6:[function(e,t,n){"use strict";var r={keys:function(){return Object.keys(this.__value)},values:function i(){var e,i=[];for(e in this.__value)i.push(this.__value[e]);return i},hasKey:function(e){return null!=this.__value[e]},destroy:function(e){var t=this.constructor.deepClone(this.__value),n=this.__value[e];return delete this.__value[e],this.set(this.__value,{oldValue:t}),n},add:function(e,t){var n=this.constructor.deepClone(this.__value);return this.__value[e]=t,this.set(this.__value,{oldValue:n}),t}};t.exports=r},{}]},{},[1])(1)});