!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cortex=e()}}(function(){return function e(t,n,i){function a(s,u){if(!n[s]){if(!t[s]){var h="function"==typeof require&&require;if(!u&&h)return h(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var o=n[s]={exports:{}};t[s][0].call(o.exports,function(e){var n=t[s][1][e];return a(n?n:e)},o,o.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t){"use strict";var n=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};t.exports=function(){var t=e("./pubsub"),r=e("./data_wrapper")(t),s={N:"new",E:"update",A:"update",D:"delete"},u=function(e){function r(e,t){a(this,r),this.__value=e,this.__path=[],this.__updates=[],this.__callbacks=t?[t]:[],this.__loopProcessing=!1,this.__subscribe(),this.__changes=[],this.__wrap()}return i(r,e),n(r,{on:{value:function(e,t){"update"===e&&this.__callbacks.push(t)}},off:{value:function(e,t){if("update"===e)if(t){for(var n=0,i=this.__callbacks.length;i>n;n++)if(t===this.__callbacks[n]){this.__callbacks.splice(n,1);break}}else this.__callbacks=[]}},update:{value:function(e){return this.__checkUpdate(e.oldValue,e.value,e.path)?(this.__loopProcessing||(this.__loopProcessing=!0,setTimeout(this.__batchAll.bind(this),0)),!0):!1}},__batchAll:{value:function(){this.__batchSetValue(),this.__wrap(),this.__loopProcessing=!1,this.__runCallbacks()}},__batchSetValue:{value:function(){for(var e=0,t=this.__updates.length;t>e;e++)this.__setValue(this.__updates[e].newValue,this.__updates[e].path);this.__updates=[]}},__runCallbacks:{value:function(){for(var e=0,t=this.__callbacks.length;t>e;e++)this.__callbacks[e]&&this.__callbacks[e](this)}},__subscribe:{value:function(){this.__eventId=t.subscribeToCortex(function(e,t){this.update(t)}.bind(this),function(e,t){this.__remove(t.path)}.bind(this))}},__remove:{value:function(e){if(e.length){var t=e.slice(0,e.length-1),n=this.__subValue(t),i=e[e.length-1],a=n[i],r=this.__clone(n);return n.constructor===Object?delete n[i]:n.constructor===Array&&n.splice(i,1),this.update({value:n,path:t,oldValue:r}),a}delete this.__wrappers,delete this.__value}},__setValue:{value:function(e,t){if(t.length>1){var n=this.__subValue(t.slice(0,t.length-1));n[t[t.length-1]]=e}else 1===t.length?this.__value[t[0]]=e:this.__value=e}},__checkUpdate:{value:function(e,t,n){var i;if(e)return i=this.__diff(e,t),this.__computeChanges(i,n),!0;var e=this.__subValue(n);return i=this.__diff(e,t),i?(this.__updates.push({newValue:t,path:n}),this.__computeChanges(i,n),!0):!1}},__computeChanges:{value:function(e,t){var n,i,a;this.__loopProcessing||(this.__changes=[]);for(var r=0,u=e.length;u>r;r++)a=e[r],n=s[a.item?a.item.kind:a.kind],i=t.slice(),a.path&&(i=i.concat(a.path)),a.index&&i.push(a.index),this.__changes.push({type:n,path:i,oldValue:a.item?a.item.lhs:a.lhs,newValue:a.item?a.item.rhs:a.rhs})}}}),r}(r);return"undefined"!=typeof window&&null!==window&&(window.Cortex=u),u}()},{"./data_wrapper":3,"./pubsub":4}],2:[function(e,t,n){(function(e){!function(i){"use strict";function a(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function s(e,t,n){s.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function u(e,t){u.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function h(e,t){h.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function l(e,t,n){l.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function o(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,i),e}function _(e,t,n,a,r,c,f){r=r||[];var p=r.slice(0);if("undefined"!=typeof c){if(a&&a(p,c))return;p.push(c)}var v=typeof e,d=typeof t;if("undefined"===v)"undefined"!==d&&n(new u(p,t));else if("undefined"===d)n(new h(p,e));else if(v!==d)n(new s(p,e,t));else if(e instanceof Date&&t instanceof Date&&e-t!==0)n(new s(p,e,t));else if("object"===v&&null!==e&&null!==t){if(f=f||[],f.indexOf(e)<0){if(f.push(e),Array.isArray(e)){{var b;e.length}for(b=0;b<e.length;b++)b>=t.length?n(new l(p,b,new h(i,e[b]))):_(e[b],t[b],n,a,p,b,f);for(;b<t.length;)n(new l(p,b,new u(i,t[b++])))}else{var w=Object.keys(e),g=Object.keys(t);w.forEach(function(r){var s=g.indexOf(r);s>=0?(_(e[r],t[r],n,a,p,r,f),g=o(g,s)):_(e[r],i,n,a,p,r,f)}),g.forEach(function(e){_(i,t[e],n,a,p,e,f)})}f.length=f.length-1}}else e!==t&&("number"===v&&isNaN(e)&&isNaN(t)||n(new s(p,e,t)))}function c(e,t,n,a){return a=a||[],_(e,t,function(e){e&&a.push(e)},n),a.length?a:i}function f(e,t,n){if(n.path&&n.path.length){var i,a=e[t],r=n.path.length-1;for(i=0;r>i;i++)a=a[n.path[i]];switch(n.kind){case"A":f(a[n.path[i]],n.index,n.item);break;case"D":delete a[n.path[i]];break;case"E":case"N":a[n.path[i]]=n.rhs}}else switch(n.kind){case"A":f(e[t],n.index,n.item);break;case"D":e=o(e,t);break;case"E":case"N":e[t]=n.rhs}return e}function p(e,t,n){if(e&&t&&n&&n.kind){for(var i=e,a=-1,r=n.path.length-1;++a<r;)"undefined"==typeof i[n.path[a]]&&(i[n.path[a]]="number"==typeof n.path[a]?new Array:{}),i=i[n.path[a]];switch(n.kind){case"A":f(i[n.path[a]],n.index,n.item);break;case"D":delete i[n.path[a]];break;case"E":case"N":i[n.path[a]]=n.rhs}}}function v(e,t,n){if(n.path&&n.path.length){var i,a=e[t],r=n.path.length-1;for(i=0;r>i;i++)a=a[n.path[i]];switch(n.kind){case"A":v(a[n.path[i]],n.index,n.item);break;case"D":a[n.path[i]]=n.lhs;break;case"E":a[n.path[i]]=n.lhs;break;case"N":delete a[n.path[i]]}}else switch(n.kind){case"A":v(e[t],n.index,n.item);break;case"D":e[t]=n.lhs;break;case"E":e[t]=n.lhs;break;case"N":e=o(e,t)}return e}function d(e,t,n){if(e&&t&&n&&n.kind){var i,a,r=e;for(a=n.path.length-1,i=0;a>i;i++)"undefined"==typeof r[n.path[i]]&&(r[n.path[i]]={}),r=r[n.path[i]];switch(n.kind){case"A":v(r[n.path[i]],n.index,n.item);break;case"D":r[n.path[i]]=n.lhs;break;case"E":r[n.path[i]]=n.lhs;break;case"N":delete r[n.path[i]]}}}function b(e,t,n){if(e&&t){var i=function(i){(!n||n(e,t,i))&&p(e,t,i)};_(e,t,i)}}var w,g,y=[];w="object"==typeof e&&e?e:"undefined"!=typeof window?window:{},g=w.DeepDiff,g&&y.push(function(){"undefined"!=typeof g&&w.DeepDiff===c&&(w.DeepDiff=g,g=i)}),a(s,r),a(u,r),a(h,r),a(l,r),Object.defineProperties(c,{diff:{value:c,enumerable:!0},observableDiff:{value:_,enumerable:!0},applyDiff:{value:b,enumerable:!0},applyChange:{value:p,enumerable:!0},revertChange:{value:d,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof g},enumerable:!0},noConflict:{value:function(){return y&&(y.forEach(function(e){e()}),y=null),c},enumerable:!0}}),"undefined"!=typeof t&&t&&"object"==typeof n&&n&&t.exports===n?t.exports=c:w.DeepDiff=c}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t){"use strict";var n=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};t.exports=function(t){var a=e("deep-diff").diff,r=function(){function e(t){i(this,e),this.__eventId=t.eventId,this.__value=t.value,this.__path=t.path||[],this.__changes=t.changes||[],this.__wrap(),this.val=this.getValue}return n(e,{set:{value:function(e,n){var i=n||{};i.value=e,i.path=this.__path,t.publish("update"+this.__eventId,i)}},getValue:{value:function(){return this.__value}},getPath:{value:function(){return this.__path}},getKey:{value:function(){return this.__path[this.__path.length-1]}},getChanges:{value:function(){return this.__changes}},didChange:{value:function(e){if(!e)return this.__changes.length>0;for(var t=0,n=this.__changes.length;n>t;t++){var i=this.__changes[t];if(i.path[0]===e||this.__hasChange(i,e))return!0}return!1}},forEach:{value:function(e){if(this.__isObject())for(var t in this.__wrappers)e(t,this.__wrappers[t],this.__wrappers);else this.__isArray()&&this.__wrappers.forEach(e)}},remove:{value:function(){t.publish("remove"+this.__eventId,{path:this.__path})}},__subValue:{value:function(e){for(var t=this.__value,n=0,i=e.length;i>n;n++)t=t[e[n]];return t}},__wrap:{value:function(){if(this.__cleanup(),this.__isObject()){this.__wrappers={};for(var e in this.__value)this.__wrapChild(e)}else if(this.__isArray()){this.__wrappers=[];for(var t=0,n=this.__value.length;n>t;t++)this.__wrapChild(t)}}},__wrapChild:{value:function(t){var n=this.__path.slice();n.push(t),this.__wrappers[t]=new e({value:this.__value[t],path:n,eventId:this.__eventId,changes:this.__childChanges(t)}),this[t]=this.__wrappers[t]}},__childChanges:{value:function(e){for(var t,n=[],i=0,a=this.__changes.length;a>i;i++){if(t=this.__changes[i],t.path[0]===e){n.push({type:t.type,path:t.path.slice(1,t.path.length),oldValue:t.oldValue,newValue:t.newValue});break}if(this.__hasChange(t,e)){n.push({type:t.type,path:[],oldValue:t.oldValue?t.oldValue[e]:void 0,newValue:t.newValue?t.newValue[e]:void 0});break}}return n}},__hasChange:{value:function(e,t){return 0===e.path.length&&(e.oldValue&&e.oldValue[t]||e.newValue&&e.newValue[t])}},__cleanup:{value:function(){if(this.__wrappers){if(this.__isObject())for(var e in this.__wrappers)delete this[e];else if(this.__isArray())for(var t=0,n=this.__wrappers.length;n>t;t++)delete this[t];delete this.__wrappers}}},__isObject:{value:function(){return this.__value&&this.__value.constructor===Object}},__isArray:{value:function(){return this.__value&&this.__value.constructor===Array}},__diff:{value:function(e,t){return a(e,t)}},__clone:{value:function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,i=e.length;i>n;n++)t[n]=this.__clone(e[n]);return t}if(e instanceof Object){t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=this.__clone(e[a]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}}}),e}(),s=e("./wrappers/array"),u=e("./wrappers/hash"),h=function(e,t){for(var n=0,i=t.length;i>n;n++)for(var a in t[n])e.prototype[a]=t[n][a]};return h(r,[s,u]),r}},{"./wrappers/array":5,"./wrappers/hash":6,"deep-diff":2}],4:[function(e,t){"use strict";var n=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};t.exports=function(){var e=function(){function e(){i(this,e),this.uid=-1,this.topics={}}return n(e,{subscribe:{value:function(e,t){this.topics.hasOwnProperty(e)||(this.topics[e]=[]),this.topics[e].push({callback:t})}},publish:{value:function(e,t){if(!this.topics.hasOwnProperty(e))return!1;for(var n=this.topics[e],i=0,a=n.length;a>i;i++)n[i].callback(e,t);return!0}},subscribeToCortex:{value:function(e,t){return this.uid+=1,this.subscribe("update"+this.uid,e),this.subscribe("remove"+this.uid,t),this.uid}},unsubscribeFromCortex:{value:function(e){delete this.topics["update"+e],delete this.topics["remove"+e]}}}),e}();return new e}()},{}],5:[function(e,t){"use strict";var n={count:function(){return this.__value.length},map:function(e){return this.__wrappers.map(e)},filter:function(e,t){return this.__wrappers.filter(e,t)},find:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return this.__wrappers[t];return null},findIndex:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return t;return-1},push:function(e){var t=this.__clone(this.__value),n=this.__value.push(e);return this.set(this.__value,{oldValue:t}),n},pop:function(){var e=this.__clone(this.__value),t=this.__value.pop();return this.set(this.__value,{oldValue:e}),t},unshift:function(e){var t=this.__clone(this.__value),n=this.__value.unshift(e);return this.set(this.__value,{oldValue:t}),n},shift:function(){var e=this.__clone(this.__value),t=this.__value.shift();return this.set(this.__value,{oldValue:e}),t},insertAt:function(e){var t=this.__clone(this.__value),n=Array.prototype.slice.call(arguments,1);Array.prototype.splice.apply(this.__value,[e,0].concat(n)),this.set(this.__value,{oldValue:t})},removeAt:function(e){var t=void 0===arguments[1]?1:arguments[1],n=this.__clone(this.__value),i=this.__value.splice(e,t);return this.set(this.__value,{oldValue:n}),i}};t.exports=n},{}],6:[function(e,t){"use strict";var n={keys:function(){return Object.keys(this.__value)},values:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){var e,t=[];for(e in this.__value)t.push(this.__value[e]);return t}),hasKey:function(e){return null!=this.__value[e]},destroy:function(e){var t=this.__clone(this.__value),n=this.__value[e];return delete this.__value[e],this.set(this.__value,{oldValue:t}),n},add:function(e,t){var n=this.__clone(this.__value);return this.__value[e]=t,this.set(this.__value,{oldValue:n}),t}};t.exports=n},{}]},{},[1])(1)});