<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Cortex : A javascript library for centrally managing data with React" />

    <link rel="stylesheet" type="text/css" media="screen" href="examples/skyline/skyline.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.8.0/react-with-addons.js"></script>
    <script src="javascripts/cortex.js"></script>

    <title>Cortex</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
      <div id="city"></div>
      <script type="text/javascript" src="examples/skyline/application.js"></script>

        <header class="inner">
          <a id="forkme_banner" href="https://github.com/mquan/cortex">View on GitHub</a>

          <h1 id="project_title">Cortex</h1>
          <h2 id="project_tagline">A javascript library for centrally managing data with React</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/mquan/cortex/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/mquan/cortex/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<h3>Key features:</h3>
<ul>
<li>supports deeply nested data with a simple API</li>
<li>performs old and new data comparison out of the box so you don't have to implement shouldComponentUpdate</li>
<li>has built-in methods for working with arrays and hashes data</li>
</ul>
<p>
  <strong>Basic demos</strong>
  <ul>
    <li>
      <a href="http://mquan.github.io/cortex/examples/skyline/">Skyline (4-level components)</a>
    </li>
    <li>
      <a href="http://mquan.github.io/cortex/examples/file_system/">File system (arbitrarily deep tree structure of 1 component type)</a>
    </li>
  </ul>
</p>

<h1>
<a name="quickstart" class="anchor" href="#quickstart"><span class="octicon octicon-link"></span></a>Quickstart</h1>

<p>Initialize a cortex object</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]};</span>

<span class="kd">var</span> <span class="nx">cortex</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cortex</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//trigger your React component to update props</span>
<span class="p">});</span>
</pre></div>

<p>Get a nested cortex object</p>

<div class="highlight highlight-javascript"><pre><span class="nx">cortex</span><span class="p">.</span><span class="nx">a</span>

<span class="c1">//Also works</span>
<span class="nx">cortex</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span>
</pre></div>

<p>Get a nested cortex element in an array</p>

<div class="highlight highlight-javascript"><pre><span class="nx">cortex</span><span class="p">.</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

<p>Get the actual value</p>

<div class="highlight highlight-javascript"><pre><span class="nx">cortex</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
<span class="c1">// ==&gt; 100</span>
</pre></div>

<p>Change data</p>

<div class="highlight highlight-javascript"><pre><span class="nx">cortex</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="nx">cortex</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
<span class="c1">// ==&gt; 200</span>
</pre></div>

<h1>
<a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>Overview</h1>

<p>In React's world data flows in one direction from the top down. That means if you want to make a change, change it at the source and let it propagate down the chain. But what happen when a child component needs to update the data? React's official guideline is to use callback for communication between parent and child components.</p>

<p>However, this simply isn't sustainable even for trivially nested data. Imagine a Restaurant app in which the Restaurant has many Orders, each has many Items, each of which has many Modifiers. If you want to update a Modifier from 'medium rare' to 'well-done' you'd have to pass the data changes several levels up. This is not only awkward but also creates unnecessary extra code in each component in the chain only for the purpose of passing data upstream.</p>

<p>Cortex's goal is to support arbitrarily deep data structure without requiring you to pass callbacks down the chain. Cortex achieves this by thinly wrap your data in an object that contains the key for locating each nested piece of data as accessed from the top level. When you change the data, internally Cortex passes the new value along with its location key to update the data at the source.</p>

<h1>
<a name="basic-example" class="anchor" href="#basic-example"><span class="octicon octicon-link"></span></a>Basic example</h1>

<p>The following example has two components Order and Item components. An Order contains an array of Items, and each Item can increase its own quantity attribute.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">Item</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">increase</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">quantity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">subTotal</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"item"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"#"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">increase</span><span class="p">}</span><span class="o">&gt;+&lt;</span><span class="err">/a&gt;</span>
        <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
        <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
        <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">subTotal</span><span class="p">()}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">Order</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Item</span> <span class="nx">item</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">return</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">items</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">orderComponent</span><span class="p">,</span>
    <span class="nx">orderData</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"Burger"</span><span class="p">,</span> <span class="nx">quantity</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">5.0</span><span class="p">},</span>
      <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"Salad"</span><span class="p">,</span> <span class="nx">quantity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">4.50</span><span class="p">},</span>
      <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"Coke"</span><span class="p">,</span> <span class="nx">quantity</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">1.50</span><span class="p">}</span>
    <span class="p">];</span>

<span class="c1">//Initialize cortex with data and pass in a callback to run when data is updated.</span>
<span class="kd">var</span> <span class="nx">orderCortex</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cortex</span><span class="p">(</span><span class="nx">orderData</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">updatedOrder</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">orderComponent</span><span class="p">.</span><span class="nx">setProps</span><span class="p">({</span><span class="nx">order</span><span class="o">:</span> <span class="nx">orderCortex</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">orderComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Order</span> <span class="nx">order</span><span class="o">=</span><span class="p">{</span><span class="nx">orderCortex</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"order"</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<p>First we initialize cortex with:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">orderCortex</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cortex</span><span class="p">(</span><span class="nx">orderData</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">updatedOrder</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">orderComponent</span><span class="p">.</span><span class="nx">setProps</span><span class="p">({</span><span class="nx">order</span><span class="o">:</span> <span class="nx">orderCortex</span><span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>Then it's passed into the Order component to render the Item components.</p>

<p>In Item component, note that we display the quantity value with <code>this.props.item.quantity.getValue()</code>. This is because <code>this.props.item.quantity</code> only gives us the wrapper of the <code>quantity</code> attribute, we need to call <code>getValue()</code> to get the actual value.</p>

<p>In <code>increase</code> method, we use <code>this.props.item.quantity.set(quantity + 1)</code> to add 1 to the current quantity value.</p>

<h1>
<a name="cortex-api" class="anchor" href="#cortex-api"><span class="octicon octicon-link"></span></a>Cortex API</h1>

<h3>
<a name="initialize" class="anchor" href="#initialize"><span class="octicon octicon-link"></span></a>Initialize:</h3>

<div class="highlight highlight-javascript"><pre><span class="k">new</span> <span class="nx">Cortex</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//trigger your React component to update</span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="instance-methods" class="anchor" href="#instance-methods"><span class="octicon octicon-link"></span></a>Instance methods:</h3>

<table>
<thead><tr>
<th>Method</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>getValue()</code></td>
<td align="left">Returns the actual value</td>
</tr>
<tr>
<td><code>set(value)</code></td>
<td align="left">Changes the value and rewrap the entire data tree</td>
</tr>
</tbody>
</table><h3>
<a name="cortex-wrapper-of-array-data-has-the-following-methods" class="anchor" href="#cortex-wrapper-of-array-data-has-the-following-methods"><span class="octicon octicon-link"></span></a>Cortex wrapper of array data has the following methods:</h3>

<table>
<thead><tr>
<th>Method</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>count()</code></td>
<td align="left">Returns length of nested wrappers</td>
</tr>
<tr>
<td><code>forEach(callback)</code></td>
<td align="left">Iterates over all elements. The callback accepts the following input <code>(wrapperElement, index, wrapperArray)</code>
</td>
</tr>
<tr>
<td><code>map(callback)</code></td>
<td align="left">Returns a new array as returned by the callback. Callback accepts same input as forEach callback</td>
</tr>
<tr>
<td><code>find(callback)</code></td>
<td align="left">Returns the first wrapper element that meets the condition returned by callback. Callback accepts same input as forEach callback.</td>
</tr>
<tr>
<td><code>findIndex(callback)</code></td>
<td align="left">Returns index of first wrapper element that meets condition returned callback. Callback accepts same input as forEach callback.</td>
</tr>
<tr>
<td><code>push(value)</code></td>
<td align="left">Inserts and rewrap the value at the end of the array.</td>
</tr>
<tr>
<td><code>pop()</code></td>
<td align="left">Removes the last element in the array</td>
</tr>
<tr>
<td><code>insertAt(index, [value])</code></td>
<td align="left">Inserts a value or an array of values starting at specified index.</td>
</tr>
<tr>
<td><code>removeAt(index, howMany = 1)</code></td>
<td align="left">Removes specified number of elements starting at index location. By default it removes 1 element if number of elements to be removed isn't specified.</td>
</tr>
</tbody>
</table><h3>
<a name="cortex-wrapper-of-hash-data-has-the-following-methods" class="anchor" href="#cortex-wrapper-of-hash-data-has-the-following-methods"><span class="octicon octicon-link"></span></a>Cortex wrapper of hash data has the following methods:</h3>

<table>
<thead><tr>
<th>Methods</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>keys()</code></td>
<td align="left">Returns the array of keys</td>
</tr>
<tr>
<td><code>values()</code></td>
<td align="left">Returns the array of values</td>
</tr>
<tr>
<td><code>hasKey(key)</code></td>
<td align="left">Returns boolean value whether the key exists</td>
</tr>
<tr>
<td><code>forEach(callback)</code></td>
<td align="left">Iterates over every key and value pair. The callback accepts the following inputs <code>(key, wrapperElement)</code>
</td>
</tr>
<tr>
<td><code>delete(key)</code></td>
<td align="left">Deletes the specified key and value pair</td>
</tr>
<tr>
<td><code>add(key, value)</code></td>
<td align="left">Adds the specified key and value pair</td>
</tr>
</tbody>
</table><h1>
<a name="install-via-bower" class="anchor" href="#install-via-bower"><span class="octicon octicon-link"></span></a>Install via Bower</h1>

<div class="highlight highlight-console"><pre><span class="go">bower install cortexjs</span>
</pre></div>

<p>Reference the js file</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/bower_components/cortexjs/build/cortex.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<h1>
<a name="using-cortex-with-node" class="anchor" href="#using-cortex-with-node"><span class="octicon octicon-link"></span></a>Using cortex with node</h1>

<div class="highlight highlight-console"><pre><span class="go">npm install cortexjs</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="nx">Cortex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"cortexjs"</span><span class="p">);</span>

<span class="nx">wrappedData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cortex</span><span class="p">({</span><span class="nx">mydata</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">wrappedData</span><span class="p">.</span><span class="nx">mydata</span><span class="p">.</span><span class="nx">getValue</span><span class="p">());</span> <span class="c1">//1</span>

<span class="nx">wrappedData</span><span class="p">.</span><span class="nx">mydata</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">wrappedData</span><span class="p">.</span><span class="nx">mydata</span><span class="p">.</span><span class="nx">getValue</span><span class="p">());</span> <span class="c1">//100</span>
</pre></div>

<h1>
<a name="buidling-cortex" class="anchor" href="#buidling-cortex"><span class="octicon octicon-link"></span></a>Buidling Cortex</h1>

<p>To build Cortex:</p>

<div class="highlight highlight-console"><pre><span class="go">gulp</span>
</pre></div>

<p>To run test:</p>

<div class="highlight highlight-console"><pre><span class="go">gulp test</span>
</pre></div>

<p>To compile jsx files in examples into js files:</p>

<div class="highlight highlight-console"><pre><span class="go">gulp react</span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cortex maintained by <a href="https://github.com/mquan">mquan</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</html>
